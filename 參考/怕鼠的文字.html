<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>怕鼠的文字</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 800px;
            height: 400px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .text-particle {
            position: absolute;
            display: inline-block;
            cursor: default;
            user-select: none;
            font-size: 24px;
            color: #333;
            transition: color 0.3s;
        }

        .text-particle:hover {
            color: #ff6b6b;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .controls label {
            display: block;
            margin-bottom: 10px;
        }

        .controls input {
            width: 200px;
        }
    </style>
</head>

<body>
    <div class="controls">
        <label>
            文字內容：
            <input type="text" id="textInput" value="怕怕怕怕怕怕怕怕">
        </label>
        <label>
            閃避半徑：<span id="radiusValue">100</span>
            <input type="range" id="radiusInput" min="50" max="200" value="100">
        </label>
        <label>
            約束力：<span id="stiffnessValue">0.1</span>
            <input type="range" id="stiffnessInput" min="1" max="100" value="10">
        </label>
        <label>
            阻尼：<span id="dampingValue">0.05</span>
            <input type="range" id="dampingInput" min="0" max="100" value="5">
        </label>
    </div>
    <div id="container"></div>

    <script>
        const engine = Matter.Engine.create({
            enableSleeping: false
        });
        const world = engine.world;
        engine.gravity.y = 0;

        const container = document.getElementById('container');
        const bounds = container.getBoundingClientRect();
        let particles = [];
        let constraints = [];
        let mousePos = { x: 0, y: 0 };

        function createTextParticles(text) {
            // 清除現有粒子
            particles.forEach(p => Matter.World.remove(world, p.body));
            constraints.forEach(c => Matter.World.remove(world, c));
            particles = [];
            constraints = [];
            container.innerHTML = '';

            // 創建新粒子
            const chars = text.split('');
            const spacing = bounds.width / (chars.length + 1);

            chars.forEach((char, i) => {
                const elem = document.createElement('div');
                elem.className = 'text-particle';
                elem.textContent = char;
                container.appendChild(elem);

                const body = Matter.Bodies.circle(
                    spacing * (i + 1),
                    bounds.height / 2,
                    2,
                    {
                        friction: 0,
                        frictionAir: 0.02,
                        restitution: 0.8
                    }
                );

                const constraint = Matter.Constraint.create({
                    pointA: { x: spacing * (i + 1), y: bounds.height / 2 },
                    bodyB: body,
                    stiffness: 0.1,
                    damping: 0.05
                });

                Matter.World.add(world, [body, constraint]);
                particles.push({ body, elem });
                constraints.push(constraint);
            });
        }

        function updateParticles() {
            particles.forEach(particle => {
                const { body, elem } = particle;
                const pos = body.position;
                elem.style.transform = `translate(${pos.x - 10}px, ${pos.y - 10}px)`;
            });
        }

        function applyMouseForce() {
            const radius = parseFloat(document.getElementById('radiusInput').value);
            particles.forEach(particle => {
                const distance = Matter.Vector.magnitude(
                    Matter.Vector.sub(particle.body.position, mousePos)
                );
                if (distance < radius) {
                    const force = Matter.Vector.mult(
                        Matter.Vector.normalise(
                            Matter.Vector.sub(particle.body.position, mousePos)
                        ),
                        0.5 * (radius - distance)
                    );
                    Matter.Body.applyForce(particle.body, mousePos, force);
                }
            });
        }

        // 事件監聽
        container.addEventListener('mousemove', (e) => {
            const rect = container.getBoundingClientRect();
            mousePos = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        });

        document.getElementById('textInput').addEventListener('input', (e) => {
            createTextParticles(e.target.value);
        });

        document.getElementById('radiusInput').addEventListener('input', (e) => {
            document.getElementById('radiusValue').textContent = e.target.value;
        });

        document.getElementById('stiffnessInput').addEventListener('input', (e) => {
            const value = e.target.value / 100;
            document.getElementById('stiffnessValue').textContent = value;
            constraints.forEach(c => c.stiffness = value);
        });

        document.getElementById('dampingInput').addEventListener('input', (e) => {
            const value = e.target.value / 100;
            document.getElementById('dampingValue').textContent = value;
            constraints.forEach(c => c.damping = value);
        });

        // 初始化
        createTextParticles(document.getElementById('textInput').value);

        // 運行引擎
        Matter.Runner.run(engine);

        function animate() {
            applyMouseForce();
            updateParticles();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>

</html>