<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>物理包裝器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
        }

        .button {
            padding: 0.5rem 1rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .button:hover {
            background: #45a049;
        }

        .physics-container {
            height: 30rem;
            width: 100%;
            border: 1px solid #ccc;
            position: relative;
            overflow: hidden;
        }

        .physics-item {
            position: absolute;
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            white-space: nowrap;
            transform-origin: center;
            cursor: default;
            user-select: none;
        }

        .title {
            font-size: 1.5rem;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="controls">
        <button class="button" onclick="startPhysics()">開始</button>
        <button class="button" onclick="resetPhysics()">重置</button>
    </div>

    <div class="physics-container" id="physicsWorld">
        <div class="physics-item title">IT 語錄</div>
        <div class="physics-item">世界上有 10 種人</div>
        <div class="physics-item">一種懂二進位</div>
        <div class="physics-item">一種不懂</div>
        <div class="physics-item">要改的太多了</div>
        <div class="physics-item">不如改天吧</div>
        <div class="physics-item">在我的機器上可以 work</div>
        <div class="physics-item">這不是 bug</div>
        <div class="physics-item">這是 feature</div>
        <div class="physics-item">你有試過重啟嗎？</div>
        <div class="physics-item">昨天還好好的 🐟</div>
    </div>

    <script>
        let engine, render, world;
        const bodies = new Map();
        let isRunning = false;
        const originalPositions = new Map();

        // 初始化物理引擎
        function initPhysics() {
            engine = Matter.Engine.create();
            world = engine.world;
            world.gravity.y = 1;

            const container = document.getElementById('physicsWorld');
            const items = container.getElementsByClassName('physics-item');

            // 記錄原始位置並創建物理物體
            Array.from(items).forEach(item => {
                const rect = item.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();

                // 儲存原始位置
                originalPositions.set(item, {
                    x: rect.left - containerRect.left,
                    y: rect.top - containerRect.top
                });

                // 創建物理物體
                const body = Matter.Bodies.rectangle(
                    rect.left - containerRect.left + rect.width / 2,
                    rect.top - containerRect.top + rect.height / 2,
                    rect.width,
                    rect.height,
                    {
                        restitution: 0.8,
                        friction: 0.005,
                        frictionAir: 0.005
                    }
                );

                bodies.set(item, body);
                Matter.Composite.add(world, body);
            });

            // 添加邊界
            const walls = [
                Matter.Bodies.rectangle(container.clientWidth / 2, -10, container.clientWidth, 20, { isStatic: true }), // 上
                Matter.Bodies.rectangle(container.clientWidth / 2, container.clientHeight + 10, container.clientWidth, 20, { isStatic: true }), // 下
                Matter.Bodies.rectangle(-10, container.clientHeight / 2, 20, container.clientHeight, { isStatic: true }), // 左
                Matter.Bodies.rectangle(container.clientWidth + 10, container.clientHeight / 2, 20, container.clientHeight, { isStatic: true }) // 右
            ];
            Matter.Composite.add(world, walls);
        }

        // 更新 DOM 元素位置
        function updateElements() {
            bodies.forEach((body, element) => {
                element.style.transform = `translate(${body.position.x - element.offsetWidth / 2}px, 
                                                   ${body.position.y - element.offsetHeight / 2}px) 
                                         rotate(${body.angle}rad)`;
            });
            if (isRunning) {
                requestAnimationFrame(updateElements);
            }
        }

        // 開始物理模擬
        function startPhysics() {
            if (!isRunning) {
                isRunning = true;
                Matter.Engine.run(engine);
                updateElements();
            }
        }

        // 重置位置
        function resetPhysics() {
            isRunning = false;
            Matter.Engine.clear(engine);
            bodies.forEach((body, element) => {
                const pos = originalPositions.get(element);
                element.style.transform = `translate(${pos.x}px, ${pos.y}px) rotate(0rad)`;
            });
            initPhysics();
        }

        // 初始化
        initPhysics();
    </script>
</body>

</html>